<html>
<head>
    <title>smsyoutube</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
<script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js"></script>

<style>

body, html {
        padding: 0; 
        margin:0; 
        background:#000;
}

#wrapper {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 */
        top: 50%;  transform: translateY(-50%);
        height: 0;
}
#wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
}
</style>

<script>

window.player = null;
window.playerReady = false;

// 2. This code loads the IFrame Player API code asynchronously.
var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// 3. This function creates an <iframe> (and YouTube player)
//    after the API code downloads.
function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: 'NyC5RKzQm9I',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
}

// 4. The API will call this function when the video player is ready.
function onPlayerReady(event) {
        window.playerReady = true;

        var ref = new Firebase('https://smsyoutube.firebaseio.com/rooms/one/messages');
        ref.limitToLast(1).on('child_added', function(childSnapshot, prevChildKey) {
                console.log("New child: ");
                console.log(childSnapshot.val());

                if (playerReady) {
                        var val = childSnapshot.val();
                        player.loadVideoById({videoId: val});
                        player.playVideo();
                }
        });

}

// 5. The API calls this function when the player's state changes.
//    The function indicates that when playing a video (state=1),
//    the player should play for six seconds and then stop.
var done = false;
function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
                // setTimeout(stopVideo, 6000);
                done = true;
        }
}

function stopVideo() {
        player.stopVideo();
}


</script>

</head>

<body>
        <div id="wrapper">
        <div id="player"></div>
        </div>
</body>
